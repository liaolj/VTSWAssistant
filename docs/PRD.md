# 语音 → 结构化文本 Windows 助手（PRD）v1.0

## 0. 摘要
- **目标**：在任意桌面输入框中，通过全局热键触发语音输入，Silero VAD 分段 → Doubao ASR 实时转写 → OpenRouter（LLM）结构化整理 → 实时/确认后写入。
- **首发范围（MVP）**：单人本地使用；中文优先；可配置 LLM/ASR；两种插入模式；原子撤销。
- **不做**：本地 LLM 推理、会议录音回放、多轨编辑.

## 1. 背景与价值
- 写作/记录效率提升；统一结构化输出；跨应用通用（浏览器/IM/Office/IDE 等）。

## 2. 用户故事（选摘）
- 作为邮件撰写者，我按下热键口述，系统把要点整理为“主题/要点/行动项”，确认后插入邮件正文。
- 作为需求记录者，我在 Jira/Notion 中口述内容，系统自动分点并生成行动项。

## 3. 功能需求（MVP）
### 3.1 启停与悬浮窗
- 全局热键（默认 Alt+S）开始/结束；悬浮窗显示录音状态、波形/字幕、插入/撤销/模板切换。

### 3.2 语音处理
- **VAD**：Silero VAD 本地推理，参数可配（threshold/min_silence/max_segment）。
- **ASR**：Doubao ASR 流式，返回中间/最终结果；断线重连/限流退避。

### 3.3 结构化整理
- **LLM**：OpenRouter 优先；可配 base_url/api_key/model/prompt；低温度；SSE 流式。
- **模板**：默认 `主题/要点/行动项`；不杜撰；不确定项以“（不确定）”标注。

### 3.4 文本写入
- 模式 A：确认后插入（默认）；模式 B：实时写入。
- 插入策略优先级：`SendInput` → `UIA` → 剪贴板兜底。
- 原子撤销：以“最近插入块”为单位。

### 3.5 配置与隐私
- `config.yaml` 支持：LLM、ASR、VAD、热键、插入策略、隐私与日志。
- 明示第三方外发；可切“仅本地处理”（禁外发）。

## 4. 非功能性需求（目标）
- 延迟：ASR 首字 200–400ms；段末 LLM 首 token 500–800ms。
- 资源：常驻内存 < 250MB（不含本地 ASR）；CPU 平均 < 10%。
- 稳定：10 分钟连续口述无卡顿；日志轮转；异常自动降级。

## 5. 兼容性（覆盖清单）
- 浏览器 input/textarea、Gmail 富文本、Notion/Jira、Slack/飞书/微信PC、Word/Outlook/WPS/记事本/VSCode 等。

## 6. 验收标准（MVP）
- 15 场景插入成功；两种写入模式 + 撤销可用；
- 断网/429 自愈与降级可见；本地模式零外发（抓包验证）。

## 7. 里程碑（4 周）
- W1：底座与配置 / W2：音频+VAD+ASR / W3：LLM+插入+撤销 / W4：兼容+隐私+发布

## 8. 关键风险与对策
- 编辑器差异 → 三层插入策略与站点适配清单。
- 费用与限速 → 聚段触发、备用模型、退避重试。
- 噪声误触 → VAD 参数与“按住说话（PTT）”模式（备选）。
